!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cp=e()}}(function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){t.exports={hcluster:e("./hcluster"),Kmeans:e("./kmeans"),kmeans:e("./kmeans").kmeans}},{"./hcluster":3,"./kmeans":4}],2:[function(e,t,n){t.exports={euclidean:function(e,t){for(var n=0,i=0;i<e.length;i++)n+=Math.pow(t[i]-e[i],2);return Math.sqrt(n)},manhattan:function(e,t){for(var n=0,i=0;i<e.length;i++)n+=Math.abs(t[i]-e[i]);return n},max:function(e,t){for(var n=0,i=0;i<e.length;i++)n=Math.max(n,Math.abs(t[i]-e[i]));return n}}},{}],3:[function(e,t,n){var i=e("./distance"),r=function(e,t,n){this.distance=e,this.linkage=t,this.threshold=void 0==n?1/0:n};r.prototype={cluster:function(e,t,n){this.clusters=[],this.dists=[],this.mins=[],this.index=[];for(var i=0;i<e.length;i++){var r={value:e[i],key:i,index:i,size:1};this.clusters[i]=r,this.index[i]=r,this.dists[i]=[],this.mins[i]=0}for(var i=0;i<this.clusters.length;i++)for(var o=0;i>=o;o++){var a=i==o?1/0:this.distance(this.clusters[i].value,this.clusters[o].value);this.dists[i][o]=a,this.dists[o][i]=a,a<this.dists[i][this.mins[i]]&&(this.mins[i]=o)}for(var s=this.mergeClosest(),i=0;s;)n&&i++%t==0&&n(this.clusters),s=this.mergeClosest();return this.clusters.forEach(function(e){delete e.key,delete e.index}),this.clusters},mergeClosest:function(){for(var e=0,t=1/0,n=0;n<this.clusters.length;n++){var i=this.clusters[n].key,r=this.dists[i][this.mins[i]];t>r&&(e=i,t=r)}if(t>=this.threshold)return!1;var o=this.index[e],a=this.index[this.mins[e]],s={left:o,right:a,key:o.key,size:o.size+a.size};this.clusters[o.index]=s,this.clusters.splice(a.index,1),this.index[o.key]=s;for(var n=0;n<this.clusters.length;n++){var r,l=this.clusters[n];o.key==l.key?r=1/0:"single"==this.linkage?(r=this.dists[o.key][l.key],this.dists[o.key][l.key]>this.dists[a.key][l.key]&&(r=this.dists[a.key][l.key])):"complete"==this.linkage?(r=this.dists[o.key][l.key],this.dists[o.key][l.key]<this.dists[a.key][l.key]&&(r=this.dists[a.key][l.key])):r="average"==this.linkage?(this.dists[o.key][l.key]*o.size+this.dists[a.key][l.key]*a.size)/(o.size+a.size):this.distance(l.value,o.value),this.dists[o.key][l.key]=this.dists[l.key][o.key]=r}for(var n=0;n<this.clusters.length;n++){var u=this.clusters[n].key;if(this.mins[u]==o.key||this.mins[u]==a.key){for(var t=u,c=0;c<this.clusters.length;c++){var d=this.clusters[c].key;this.dists[u][d]<this.dists[u][t]&&(t=d)}this.mins[u]=t}this.clusters[n].index=n}return delete o.key,delete a.key,delete o.index,delete a.index,!0}};var o=function(e,t,n,o,a,s){t=t||"euclidean",n=n||"average","string"==typeof t&&(t=i[t]);var l=new r(t,n,o).cluster(e,a,s);return void 0===o?l[0]:l};t.exports=o},{"./distance":2}],4:[function(e,t,n){function i(e){this.centroids=e||[]}var r=e("./distance");i.prototype.randomCentroids=function(e,t){var n=e.slice(0);return n.sort(function(){return Math.round(Math.random())-.5}),n.slice(0,t)},i.prototype.classify=function(e,t){var n=1/0,i=0;t=t||"euclidean","string"==typeof t&&(t=r[t]);for(var o=0;o<this.centroids.length;o++){var a=t(e,this.centroids[o]);n>a&&(n=a,i=o)}return i},i.prototype.cluster=function(e,t,n,i,o){t=t||Math.max(2,Math.ceil(Math.sqrt(e.length/2))),n=n||"euclidean","string"==typeof n&&(n=r[n]),this.centroids=this.randomCentroids(e,t);for(var a=new Array(e.length),s=new Array(t),l=0,u=!0;u;){for(var c=0;c<e.length;c++)a[c]=this.classify(e[c],n);u=!1;for(var d=0;t>d;d++){for(var f=[],c=0;c<a.length;c++)a[c]==d&&f.push(e[c]);if(f.length){for(var p=this.centroids[d],y=new Array(p.length),g=0;g<p.length;g++){for(var m=0,c=0;c<f.length;c++)m+=f[c][g];y[g]=m/f.length,y[g]!=p[g]&&(u=!0)}this.centroids[d]=y,s[d]=f}}o&&l++%i==0&&o(s)}return s},i.prototype.toJSON=function(){return JSON.stringify(this.centroids)},i.prototype.fromJSON=function(e){return this.centroids=JSON.parse(e),this},t.exports=i,t.exports.kmeans=function(e,t){return(new i).cluster(e,t)}},{"./distance":2}],5:[function(e,t,n){(function(n){"use strict";function i(e,t){var n=i.distance.table(e),l=o.hcluster(e,function(e,t){var i=r.Encoding.shorthand(e),o=r.Encoding.shorthand(t);return n[i][o]},"average",a.CLUSTER_THRESHOLD),u=l.map(function(e){return s.traverse(e,[])}).map(function(e){return e.sort(function(e,t){return t._info.score-e._info.score})}).filter(function(e){return e.length>0}).sort(function(e,t){return t[0]._info.score-e[0]._info.score});return u.dist=n,u}t.exports=i;var r="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,o=e("clusterfck"),a=e("./clusterconsts"),s=e("../util");i.distance=e("./distance")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":19,"./clusterconsts":6,"./distance":7,clusterfck:1}],6:[function(e,t,n){"use strict";function i(e,t){var n=t[0],i=t[1],r=t[2];return e[n]=e[n]||{},e[i]=e[i]||{},e[n][i]=e[i][n]=r,e}var r=t.exports={};r.SWAPPABLE=.05,r.DIST_MISSING=1,r.CLUSTER_THRESHOLD=1,r.DIST_BY_ENCTYPE=[["x","y",r.SWAPPABLE],["row","col",r.SWAPPABLE],["color","shape",r.SWAPPABLE],["color","detail",r.SWAPPABLE],["detail","shape",r.SWAPPABLE],["size","color",r.SWAPPABLE]].reduce(i,{})},{}],7:[function(e,t,n){(function(n){"use strict";var i="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,r=e("./clusterconsts"),o=e("../util"),a={};t.exports=a,a.table=function(e){var t,n,r=e.length,o=e.map(function(e){return a.getEncTypeByColumnName(e)}),s=e.map(i.Encoding.shorthand),l={};for(t=0;r>t;t++)l[s[t]]={};for(t=0;r>t;t++)for(n=t+1;r>n;n++){var u=s[n],c=s[t];l[u][c]=l[c][u]=a.get(o[t],o[n])}return l},a.get=function(e,t){var n=o.union(i.keys(e.col),i.keys(t.col)),a=0;n.forEach(function(n){var i=e.col[n],o=t.col[n];i&&o?i.encType!=o.encType&&(a+=(r.DIST_BY_ENCTYPE[i.encType]||{})[o.encType]||1):a+=r.DIST_MISSING});var s=i.Encoding.isStack(e),l=i.Encoding.isStack(t);return(s||l)&&(s&&l?e.encoding.color.name!==t.encoding.color.name&&(a+=1):a+=1),a},a.getEncTypeByColumnName=function(e){var t={},n=e.encoding;return i.keys(n).forEach(function(e){var r=i.duplicate(n[e]);r.encType=e,t[r.name||""]=r,delete r.name}),{marktype:e.marktype,col:t,encoding:e.encoding}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":19,"./clusterconsts":6}],8:[function(e,t,n){"use strict";var i=t.exports={gen:{},cluster:{},rank:{}};i.gen.projections={type:"object",properties:{omitDotPlot:{type:"boolean","default":!1,description:"remove all dot plots"},maxCardinalityForAutoAddOrdinal:{type:"integer","default":50,description:"max cardinality for ordinal field to be considered for auto adding"},alwaysAddHistogram:{type:"boolean","default":!0}}},i.gen.aggregates={type:"object",properties:{config:{type:"object"},data:{type:"object"},tableTypes:{type:"boolean","default":"both","enum":["both","aggregated","disaggregated"]},genDimQ:{type:"string","default":"auto","enum":["auto","bin","cast","none"],description:"Use Q as Dimension either by binning or casting"},minCardinalityForBin:{type:"integer","default":20,description:"minimum cardinality of a field if we were to bin"},omitDotPlot:{type:"boolean","default":!1,description:"remove all dot plots"},omitMeasureOnly:{type:"boolean","default":!1,description:"Omit aggregation with measure(s) only"},omitDimensionOnly:{type:"boolean","default":!0,description:"Omit aggregation with dimension(s) only"},addCountForDimensionOnly:{type:"boolean","default":!0,description:"Add count when there are dimension(s) only"},aggrList:{type:"array",items:{type:["string"]},"default":[void 0,"avg"]},timeUnitList:{type:"array",items:{type:["string"]},"default":["year"]},consistentAutoQ:{type:"boolean","default":!0,description:"generate similar auto transform for quant"}}},i.gen.encodings={type:"object",properties:{marktypeList:{type:"array",items:{type:"string"},"default":["point","bar","line","area","text","tick"],description:"allowed marktypes"},encodingTypeList:{type:"array",items:{type:"string"},"default":["x","y","row","col","size","color","text","detail"],description:"allowed encoding types"},maxGoodCardinalityForFacets:{type:"integer","default":5,description:"maximum cardinality of a field to be put on facet (row/col) effectively"},maxCardinalityForFacets:{type:"integer","default":20,description:"maximum cardinality of a field to be put on facet (row/col)"},maxGoodCardinalityForColor:{type:"integer","default":7,description:"maximum cardinality of an ordinal field to be put on color effectively"},maxCardinalityForColor:{type:"integer","default":20,description:"maximum cardinality of an ordinal field to be put on color"},maxCardinalityForShape:{type:"integer","default":6,description:"maximum cardinality of an ordinal field to be put on shape"},omitTranpose:{type:"boolean","default":!0,description:"Eliminate all transpose by (1) keeping horizontal dot plot only (2) for OxQ charts, always put O on Y (3) show only one DxD, MxM (currently sorted by name)"},omitDotPlot:{type:"boolean","default":!1,description:"remove all dot plots"},omitDotPlotWithExtraEncoding:{type:"boolean","default":!0,description:"remove all dot plots with >1 encoding"},omitMultipleRetinalEncodings:{type:"boolean","default":!0,description:"omit using multiple retinal variables (size, color, shape)"},omitNonTextAggrWithAllDimsOnFacets:{type:"boolean","default":!0,description:"remove all aggregated charts (except text tables) with all dims on facets (row, col)"},omitOneDimensionCount:{type:"boolean","default":!1,description:"omit one dimension count"},omitSizeOnBar:{type:"boolean","default":!1,description:"do not use bar's size"},omitStackedAverage:{type:"boolean","default":!0,description:"do not stack bar chart with average"},alwaysGenerateTableAsHeatmap:{type:"boolean","default":!0}}}},{}],9:[function(e,t,n){t.exports={consts:e("./consts"),cluster:e("./cluster/cluster"),gen:e("./gen/gen"),rank:e("./rank/rank"),util:e("./util"),auto:"-, sum"}},{"./cluster/cluster":5,"./consts":8,"./gen/gen":13,"./rank/rank":17,"./util":19}],10:[function(e,t,n){(function(n){"use strict";function i(e,t,n,i){function s(t){t=r.duplicate(t),t.key=r.field.shorthands(t),e.push(t)}function l(){if(i.omitMeasureOnly||i.omitDimensionOnly){var e=!1,t=!1,n=!1;if(g.forEach(function(i){r.field.isDimension(i)?t=!0:(e=!0,i.aggregate||(n=!0))}),!t&&!n&&i.omitMeasureOnly)return;if(!e&&(i.addCountForDimensionOnly&&(g.push(r.field.count()),s(g),g.pop()),i.omitDimensionOnly))return}i.omitDotPlot&&1===g.length||s(g)}function u(e,t,n,i){var r=t===!0||null===t,o=t===!1||null===t;i?r&&(g[e].aggregate=i,y(e+1,!0,n),delete g[e].aggregate):o&&y(e+1,!1,n)}function c(e,t,n){g[e].bin=!0,y(e+1,t,n),delete g[e].bin}function d(e,o,s){var l=t[e],d=o===!0||null===o;if(g[e]={name:l.name,type:l.type},"count"===l.aggregate)d&&(g[e].aggregate=l.aggregate,y(e+1,!0,s));else if(l._aggregate)u(e,o,s,l._aggregate);else if(l._raw)u(e,o,s,void 0);else if(l._bin)c(e,o,s);else if(i.aggrList.forEach(function(t){i.consistentAutoQ&&s!==a&&s!==t||u(e,o,t,t)}),(!i.consistentAutoQ||r.isin(s,[a,"bin","cast","autocast"]))&&!m){var f=r.field.cardinality(l,n)>i.minCardinalityForBin,p="auto"===i.genDimQ,h="bin"===i.genDimQ||p&&f,v="cast"===i.genDimQ||p&&!f;h&&r.isin(s,[a,"bin","autocast"])&&c(e,o,p?"autocast":"bin"),v&&r.isin(s,[a,"cast","autocast"])&&(g[e].type="O",y(e+1,o,p?"autocast":"cast"),g[e].type="Q")}}function f(e,t,n,i){g[e].timeUnit=i,y(e+1,t,n),delete g[e].timeUnit}function p(e,n,r){var o=t[e];g[e]={name:o.name,type:o.type},o._timeUnit?f(e,n,r,o._timeUnit):i.timeUnitList.forEach(function(t){void 0===t?n||y(e+1,!1,r):f(e,n,r,t)})}function y(e,n,i){if(e===t.length)return void l();var r=t[e];switch(r.type){case Q:d(e,n,i);break;case T:p(e,n,i);break;case O:case N:default:g[e]=r,y(e+1,n,i)}}i=r.schema.util.extend(i||{},o.gen.aggregates);var g=new Array(t.length),m=r.any(t,function(e){return r.field.isTypes(e,[N,O])}),h="aggregated"===i.tableTypes?!0:"disaggregated"===i.tableTypes?!1:null;return y(0,h,a),e}var r="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,o=e("../consts"),a="*";t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../consts":8}],11:[function(e,t,n){(function(n){"use strict";function i(e,t,n,i,o){i=a.schema.util.extend(i||{},c.gen.encodings);var l=s([],t,n,i);return o?l.reduce(function(e,t){return e[t]=r([],t,n,i),e},{}):l.reduce(function(e,t){return r(e,t,n,i)},[])}function r(e,t,n,i){return l(t,n,i).forEach(function(r){var s=a.duplicate({data:i.data,marktype:r,encoding:t,config:i.config}),l=o(s,n,i),c=u.encoding(l,n,i);l._info=c,e.push(l)}),e}function o(e,t,n){"text"===e.marktype&&n.alwaysGenerateTableAsHeatmap&&(e.encoding.color=e.encoding.text);var i=e.encoding;return["x","y"].forEach(function(e){var n=i[e];if(n&&a.field.isMeasure(n)&&!a.field.isCount(n)){var r=t[n.name];r&&r.stdev/r.avg<.01&&(n.scale={zero:!1})}}),e}var a="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,s=e("./encs"),l=e("./marktypes"),u=e("../rank/rank"),c=e("../consts");t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../consts":8,"../rank/rank":17,"./encs":12,"./marktypes":14}],12:[function(e,t,n){(function(n){"use strict";function i(e,t,n,i){return i.omitMultipleRetinalEncodings&&(e.color||e.size||e.shape)?!1:!0}function r(e,t,n,r){return i(e,t,n,r)?u.field.isMeasure(t)||u.field.cardinality(t,n)<=r.maxCardinalityForColor:!1}function o(e,t,n,r){return i(e,t,n,r)?t.bin&&t.type===Q?!1:t.timeUnit&&t.type===T?!1:u.field.cardinality(t,n)<=r.maxCardinalityForColor:!1}function a(e){return u.field.isTypes(e.y,[N,O])&&p(e.x)?!0:p(e.y)&&!u.field.isTypes(e.x,[N,O])&&f(e.x)?!0:!1}function s(e,t,n){if(e.text)return d.satisfyRules(e,TEXT,t,n);if(e.x||e.y||e.geo||e.arc){if(e.row||e.col){if(!e.x||!e.y)return!1;if(n.omitNonTextAggrWithAllDimsOnFacets&&l.isAggrWithAllDimOnFacets(e))return!1}if(e.x&&e.y){var i=!!f(e.x),r=!!f(e.y);if(i&&r&&!u.enc.isAggregate(e))return!1;if(n.omitTranpose)if(i^r){if(!a(e))return!1}else if(e.y.type===T||e.x.type===T){if(e.y.type===T&&e.x.type!==T)return!1}else if(e.x.name>e.y.name)return!1;return!0}if(n.omitDotPlot)return!1;if(n.omitTranpose&&e.y)return!1;if(n.omitDotPlotWithExtraEncoding&&u.keys(e).length>1)return!1;if(n.omitOneDimensionCount){if(e.x&&"count"==e.x.aggregate&&!e.y)return!1;if(e.y&&"count"==e.y.aggregate&&!e.x)return!1}return!0}return!1}function l(e,t,n,i){function r(a){if(a===t.length)return void(s(o,n,i)&&e.push(u.duplicate(o)));var l=t[a];for(var c in i.encodingTypeList){var d=i.encodingTypeList[c],p=f(l);d in o||!(p&&y[d].dimension||!p&&y[d].measure)||y[d].rules&&!y[d].rules(o,l,n,i)||(o[d]=l,r(a+1),delete o[d])}}i=u.schema.util.extend(i||{},c.gen.encodings);var o={};return r(0),e}e("../globals");var u="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,c=e("../consts"),d=e("./marktypes"),f=u.field.isDimension,p=u.field.isMeasure;t.exports=l;var y={x:{dimension:!0,measure:!0,multiple:!0},y:{dimension:!0,measure:!0,multiple:!0},row:{dimension:!0,multiple:!0},col:{dimension:!0,multiple:!0},shape:{dimension:!0,rules:o},size:{measure:!0,rules:i},color:{dimension:!0,measure:!0,rules:r},text:{measure:!0},detail:{dimension:!0}};l.isAggrWithAllDimOnFacets=function(e){var t=!1,n=!1;for(var i in e){var r=e[i];if(r.aggregate&&(t=!0),u.field.isDimension(r)&&i!==ROW&&i!==COL&&(n=!0),t&&n)break}return t&&!n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../consts":8,"../globals":16,"./marktypes":14}],13:[function(e,t,n){"use strict";var i=e("../util"),r=t.exports={aggregates:e("./aggregates"),projections:e("./projections"),encodings:e("./encodings"),encs:e("./encs"),marktypes:e("./marktypes")};r.charts=function(e,t,n,o){t=i.gen.getOpt(t),o=void 0===o?{encodings:1}:o;var a,s,l=t.genAggr?r.aggregates([],e,t):[e],u=0;return o===!0||o&&o.aggregate?a=l.reduce(function(e,n){return r.encs(e,n,t)},[]):(a=l.map(function(e){return r.encs([],e,t)},!0),u+=1),o===!0||o&&o.encodings?s=i.nestedReduce(a,function(e,i){return r.marktypes(e,i,t,n)},u,!0):(s=i.nestedMap(a,function(e){return r.marktypes([],e,t,n)},u,!0),u+=1),s}},{"../util":19,"./aggregates":10,"./encodings":11,"./encs":12,"./marktypes":14,"./projections":15}],14:[function(e,t,n){(function(n){"use strict";function i(e,t,n){n=f.schema.util.extend(n||{},p.gen.encodings);var i=n.marktypeList.filter(function(i){return m.satisfyRules(e,i,t,n)});return i}function r(e,t,n){return f.field.cardinality(e,t)<=n.maxCardinalityForFacets}function o(e,t,n){return e.row&&!r(e.row,t,n)?!1:e.col&&!r(e.col,t,n)?!1:!0}function a(e,t,n){if(!o(e,t,n))return!1;if(e.x&&e.y){var i=y(e.x),r=y(e.y);if(i&&r){if(e.shape)return!1;if(e.color&&y(e.color))return!1}}else{if(n.omitDotPlot)return!1;if(n.omitTranpose&&e.y)return!1;if(n.omitDotPlotWithExtraEncoding&&f.keys(e).length>1)return!1;if(e.shape)return!1}return!0}function s(e,t,n){if(e.x||e.y){if(f.enc.isAggregate(e))return!1;var i=y(e.x),r=y(e.y);return!i&&(!e.y||g(e.y))||!r&&(!e.x||g(e.x))}return!1}function l(e,t,n){if(!o(e,t,n))return!1;if(!e.x&&!e.y)return!1;if(n.omitSizeOnBar&&void 0!==e.size)return!1;var i=(!e.x||void 0===e.x.aggregate)^(!e.y||void 0===e.y.aggregate);if(i){var r=(!e.x||y(e.x))^(!e.y||y(e.y));if(r){var a=e.x.aggregate||e.y.aggregate;return!(n.omitStackedAverage&&"avg"===a&&e.color)}}return!1}function u(e,t,n){return o(e,t,n)?"T"==e.x.type&&e.x.timeUnit&&"Q"==e.y.type&&e.y.aggregate:!1}function c(e,t,n){return o(e,t,n)&&u(e,t,n)?!(n.omitStackedAverage&&"avg"===e.y.aggregate&&e.color):!1}function d(e,t,n){return!(!e.row&&!e.col||!e.text||!e.text.aggregate||e.x||e.y||e.size||n.alwaysGenerateTableAsHeatmap&&e.color)}var f="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,p=e("../consts"),y=f.field.isDimension,g=f.field.isOrdinalScale,m=t.exports=i,h=m.rule={point:a,bar:l,line:u,area:c,text:d,tick:s};m.satisfyRules=function(e,t,n,i){var r=f.compiler.marks[t],o=r.requiredEncoding,a=r.supportedEncoding;for(var s in o)if(!(o[s]in e))return!1;for(var l in e)if(!a[l])return!1;return!h[t]||h[t](e,n,i)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../consts":8}],15:[function(e,t,n){(function(n){"use strict";function i(e,t,n){n=s.schema.util.extend(n||{},a.gen.projections);var u=[],c=[],d=[],f=!1,p=!1,y={};e.forEach(function(e,i){if(y[e.name]=i,e.selected)u.push(e),l(e)||"T"===e.type?f=!0:p=!0;else if(e.selected!==!1&&!s.field.isCount(e)){if(s.field.isDimension(e)&&!n.maxCardinalityForAutoAddOrdinal&&s.field.cardinality(e,t,15)>n.maxCardinalityForAutoAddOrdinal)return;c.push(e)}}),c.sort(r(f,p,y));var g=o.chooseKorLess(c,1);return g.forEach(function(e){var t=u.concat(e);if(t.length>0){if(n.omitDotPlot&&1===t.length)return;d.push(t)}}),d.forEach(function(e){e.key=i.key(e)}),d}function r(e,t,n){return function(t,i){return t.type!==i.type?e?u[i.type]-u[t.type]:u[t.type]-u[i.type]:n[t.name]-n[i.name]}}var o=e("../util"),a=e("../consts"),s="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,l=s.field.isDimension;t.exports=i;var u={N:0,O:0,T:2,Q:3};i.key=function(e){return e.map(function(e){return s.field.isCount(e)?"count":e.name}).join(",")}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../consts":8,"../util":19}],16:[function(e,t,n){(function(t){"use strict";var n=t||window;e("vega-lite/src/globals"),n.CHART_TYPES={TABLE:"TABLE",BAR:"BAR",PLOT:"PLOT",LINE:"LINE",AREA:"AREA",MAP:"MAP",HISTOGRAM:"HISTOGRAM"},n.ANY_DATA_TYPES=15}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"vega-lite/src/globals":20}],17:[function(e,t,n){t.exports={encoding:e("./rankEncodings")}},{"./rankEncodings":18}],18:[function(e,t,n){(function(n){"use strict";function i(e,t,n,l){var u=[],c=r.keys(e.encoding),d=e.marktype,f=e.encoding,p=r.enc.reduce(e.encoding,function(e,t,n){var i=r.field.shorthand(t),o=e[i]=e[i]||[];return o.push({encType:n,field:t}),e},{});return r.forEach(p,function(o){var a=o.map(function(e){return e.encType+r.shorthand.assign+r.field.shorthand(e.field)+" "+(l&&l[e.field.name]?"[x]":"[ ]")}),s=o.map(function(o){var a=r.field.isDimension(o.field)?"dimension":"measure",s=i.score[a](o.field,o.encType,e.marktype,t,n);return!l||l[o.field.name]?s:Math.pow(s,.125)});u.push({reason:a.join(" | "),score:Math.max.apply(null,s)})}),d===TEXT||f.x&&f.y&&o(f.x)^o(f.y)&&u.push({reason:"OxQ plot",score:.8}),c.length>1&&d!==TEXT&&(f.x&&f.y||f.geo||f.text||u.push({reason:"unused position",score:a})),u.push({reason:"marktype="+d,score:s[d]}),{score:u.reduce(function(e,t){return e*t.score},1),features:u}}e("../globals");var r="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,o=r.field.isDimension;t.exports=i;var a=.5,s={line:.99,area:.98,bar:.97,tick:.96,point:.95,circle:.94,square:.94,text:.8},l={},u={},c=.1,d=.01;l.minor=.01,l.pos=1,l.Y_T=.8,l.facet_text=1,l.facet_good=.675,l.facet_ok=.55,l.facet_bad=.4,l.color_good=.7,l.color_ok=.65,l.color_bad=.3,l.color_stack=.6,l.shape=.6,l.detail=.5,l.bad=c,l.terrible=d,u.pos=1,u.size=.6,u.color=.5,u.text=.4,u.bad=c,u.terrible=d,i.dimensionScore=function(e,t,n,i,o){var a=r.field.cardinality(e,i);switch(t){case X:return r.field.isTypes(e,[N,O])?l.pos-l.minor:l.pos;case Y:return r.field.isTypes(e,[N,O])?l.pos-l.minor:e.type===T?l.Y_T:l.pos-l.minor;case COL:return n===TEXT?l.facet_text:a<=o.maxGoodCardinalityForFacets?l.facet_good:a<=o.maxCardinalityForFacets?l.facet_ok:l.facet_bad;case ROW:return n===TEXT?l.facet_text:(a<=o.maxGoodCardinalityForFacets?l.facet_good:a<=o.maxCardinalityForFacets?l.facet_ok:l.facet_bad)-l.minor;case COLOR:var s=e.bin&&e.type===Q||e.timeUnit&&e.type===T,u="bar"===n||"area"===n;return s?l.color_bad:u?l.color_stack:a<=o.maxGoodCardinalityForColor?l.color_good:a<=o.maxCardinalityForColor?l.color_ok:l.color_bad;case SHAPE:return a<=o.maxCardinalityForShape?l.shape:d;case DETAIL:return l.detail}return d},i.dimensionScore.consts=l,i.measureScore=function(e,t,n,i,r){switch(t){case X:return u.pos;case Y:return u.pos;case SIZE:return"bar"===n?c:n===TEXT?c:"line"===n?c:u.size;case COLOR:return u.color;case TEXT:return u.text}return c},i.measureScore.consts=u,i.score={dimension:i.dimensionScore,measure:i.measureScore}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../globals":16}],19:[function(e,t,n){"use strict";var i=e("./consts"),r=t.exports={gen:{}};r.isArray=Array.isArray||function(e){return"[object Array]"=={}.toString.call(e)},r.json=function(e,t){return JSON.stringify(e,null,t)},r.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},r.nestedMap=function(e,t,n,i){return e.map(0===n?t:function(e){var o=r.nestedMap(e,t,n-1);return i?o.filter(r.nonEmpty):o})},r.nestedReduce=function(e,t,n,i){return 0===n?e.reduce(t,[]):e.map(function(e){var o=r.nestedReduce(e,t,n-1);return i?o.filter(r.nonEmpty):o})},r.nonEmpty=function(e){return!r.isArray(e)||e.length>0},r.traverse=function(e,t){return void 0!==e.value?t.push(e.value):(e.left&&r.traverse(e.left,t),e.right&&r.traverse(e.right,t)),t},r.union=function(e,t){var n={};return e.forEach(function(e){n[e]=!0}),t.forEach(function(e){n[e]=!0}),r.keys(n)},r.gen.getOpt=function(e){return(e?r.keys(e):[]).reduce(function(t,n){return t[n]=e[n],t},Object.create(i.gen.DEFAULT_OPT))},r.powerset=function(e){for(var t=[[]],n=0;n<e.length;n++)for(var i=0,r=t.length;r>i;i++)t.push(t[i].concat(e[n]));return t},r.chooseKorLess=function(e,t){for(var n=[[]],i=0;i<e.length;i++)for(var r=0,o=n.length;o>r;r++){var a=n[r].concat(e[i]);a.length<=t&&n.push(a)}return n},r.chooseK=function(e,t){for(var n=[[]],i=[],r=0;r<e.length;r++)for(var o=0,a=n.length;a>o;o++){var s=n[o].concat(e[r]);s.length<t?n.push(s):s.length===t&&i.push(s)}return i},r.cross=function(e,t){for(var n=[],i=0;i<e.length;i++)for(var r=0;r<t.length;r++)n.push(e[i].concat(t[r]));return n}},{"./consts":8}],20:[function(e,t,n){(function(e){"use strict";var t=e||window;t.TABLE="table",t.RAW="raw",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.TEXT="text",t.DETAIL="detail",t.N="N",t.O="O",t.Q="Q",t.T="T"}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[9])(9)});
//# sourceMappingURL=compass.min.js.map